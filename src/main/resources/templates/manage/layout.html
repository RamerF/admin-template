<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
      layout:decorate="~{base_layout}" lang="zh">
<head>
    <title>layout</title>
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8"/>
    <link rel="shortcut icon" href="https://www.thymeleaf.org/doc/images/favicon.ico" type="image/x-icon"/>
    <!-- mdc 部分组件未实现,该部分使用老版本 -->
    <!--    <link rel="stylesheet" href="/libs/material-design-light/material.css"/>-->
    <!--    <script type="text/javascript" src="/libs/material-design-light/material.js"></script>-->
    <!-- mdc -->
    <script src="/libs/material-components-web/material-components-web.js"></script>
    <script src="/script/utils/common-util.js"></script>
    <link href="/libs/material-components-web/material-components-web.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/libs/material-components-web/material-icons.css">
    <link rel="stylesheet" href="/style/manage/layout.css">
</head>
<body class="container" layout:fragment="container">
<header class="mdc-top-app-bar mdc-top-app-bar--dense header">
    <div class="mdc-top-app-bar__row">
        <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
            <a href="#" class="material-icons mdc-top-app-bar__navigation-icon">menu</a>
            <span class="mdc-top-app-bar__title">xxx管理系统</span>
        </section>
    </div>
</header>
<aside class="mdc-drawer-fixed mdc-top-app-bar--fixed-adjust">
    <div class="menu-container mdc-list">
        <th:block th:each="m,stat:${menus}" th:inline="text">
            <li th:if="${stat.index ne 0}" class="mdc-list-divider mdc-list-divider--padded"></li>
            <h3 class="mdc-list-group__subheader" th:attr="data-href=${m.url}">[[${m.name}]]</h3>
            <ul class="mdc-list" th:if="not ${#lists.isEmpty(m.children)}"
                th:include="this::retrieveChild(${m.children})">
            </ul>
        </th:block>
    </div>
</aside>
<div class="mdc-drawer-app-content mdc-top-app-bar--fixed-adjust">
    <main class="main-content" id="main-content" layout:fragment="main-container"></main>
</div>
<th:block th:fragment="retrieveChild(children)">
    <th:block th:each="c:${children}">
        <li th:class="${#lists.isEmpty(c.children) ? 'mdc-list-item':''}" th:attr="data-href=${c.url}">
            <h3 class="mdc-list-group__subheader">[[${c.name}]]</h3>
            <ul class="mdc-list" th:if="not ${#lists.isEmpty(c.children)}"
                th:include="this::retrieveChild(${c.children})"></ul>
        </li>
    </th:block>
</th:block>
</body>
<th:block layout:fragment="common-script">
    <script type="text/javascript">
      $(function() {
        // 自动注册 data-mdc-auto-init 元素
        mdc.autoInit();
        // 菜单折叠
        $.collapse('aside.mdc-drawer-fixed');
        //  下拉框宽度修复,保持与父容器同宽
        let clientWidth = document.body.clientWidth;
        window.onresize = function() {
          let clientWidthLive = document.body.clientWidth;
          if (clientWidth !== clientWidthLive) {
            clientWidth = clientWidthLive;
            console.log(' log: ' + '宽度更新');
            $('.select-width-fixed').width($('.mdc-select.select-width-fixed').parent().width());
          }
        };
        $('.select-width-fixed').width($('.mdc-select.select-width-fixed').parent().width());
        // 添加ripple效果
        new mdc.list.MDCList(document.querySelector('.mdc-list')).listElements.map(
            (listItemEl) => new mdc.ripple.MDCRipple(listItemEl));
        // 链接跳转
        $('aside li[data-href]').click(function() {
          window.location.href = this.dataset.href;
        });
        // TODO-WARN: 自动选择菜单
        // var url = location.href.substr(location.origin.length);
        // url = url.endsWith('#') ? url.substr(0, url.length - 1) : url;
        // var activeMenu = $('a[href="' + url + '"]');
        // activeMenu.parents('ul').prev('a')[0].click();
        // activeMenu.addClass('active-menu');
      });
    </script>
    <th:block layout:fragment="script">

    </th:block>
</th:block>
</html>
